---
import BaseLayout from "../../layouts/BaseLayout.astro";
import NewsCard from "../../components/NewsCard.astro";
import Pagination from "../../components/Pagination.astro";
import { classifyEventType, classifyTopics, EVENT_LABELS, getNewsPage, TOPIC_LABELS } from "../../lib/news";

export function getStaticPaths() {
  const firstPage = getNewsPage(1);
  const totalPages = firstPage.totalPages;
  return Array.from({ length: totalPages }, (_, index) => ({
    params: { page: String(index + 1) },
  }));
}

const page = Number(Astro.params.page || "1");
const { items, totalPages, currentPage, totalItems } = getNewsPage(page);
---
<BaseLayout title={`Page ${currentPage}`} description="Latest official policy and macro updates">
  <section class="glass-panel rounded-3xl px-4 py-4 shadow-soft sm:px-6 sm:py-6">
    <div class="flex flex-wrap items-end justify-between gap-4">
      <div>
        <h2 class="page-title text-xl font-semibold text-ink-950 sm:text-2xl">Latest</h2>
      </div>
      <div class="text-xs text-ink-900/70 sm:text-sm">
        Page {currentPage}/{totalPages} Â· {totalItems} items
      </div>
    </div>
    {totalPages > 1 && <Pagination current={currentPage} total={totalPages} />}
    {items.length === 0 ? (
      <div class="mt-8 rounded-2xl border border-dashed border-ink-900/20 px-6 py-12 text-center text-sm text-ink-900/60">
        No data yet. Enable sources in crawler/sources_config.yaml and run the crawler.
      </div>
    ) : (
      <div class="mt-4">
        {items.map((item) => (
          <NewsCard
            item={item}
            density="compact"
            topics={classifyTopics(item).map((t) => TOPIC_LABELS[t])}
            eventTypeLabel={EVENT_LABELS[classifyEventType(item)]}
          />
        ))}
      </div>
    )}
    {totalPages > 1 && <Pagination current={currentPage} total={totalPages} />}
  </section>
</BaseLayout>
